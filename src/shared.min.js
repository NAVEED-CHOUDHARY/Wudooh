const keyTextSize="textSize",keyLineHeight="lineHeight",keyOnOff="onOff",keyFont="font",keyWhitelisted="whitelisted",keyCustomSettings="customSettings",keyCustomFonts="customFonts",keys=["textSize","lineHeight","onOff","font","whitelisted","customSettings","customFonts"],defaultFont="Sahl Naskh",defaultTextSize=125,defaultLineHeight=145,defaultDelay=250,reasonUpdateAllText="updateAllText",reasonInjectCustomFonts="injectCustomFonts",reasonToggleOff="toggleOff",browserName=(()=>{const t=navigator.userAgent.toLowerCase();return t.includes("firefox")?"firefox":t.includes("edg")?"edge":t.includes("opr")||t.includes("opera")?"opera":t.includes("chrome")?"chrome":null})(),isChromium=(()=>"chrome"===browserName||"edge"===browserName||"opera"===browserName)();class CustomSetting{constructor(t,e,n,s){this.url=t,this.textSize=e,this.lineHeight=n,this.font=s}static isValidCustomSetting(t){const e=t.url,n=t.textSize,s=t.lineHeight,o=t.font;return!!e&&"string"==typeof e&&!!n&&"number"==typeof n&&n>=100&&n<=300&&!!s&&"number"==typeof s&&s>=100&&s<=300&&!!o&&"string"==typeof o}static isCustomSetting(t){return!!t&&t.hasOwnProperty("url")&&t.hasOwnProperty("textSize")&&t.hasOwnProperty("lineHeight")&&t.hasOwnProperty("font")&&this.isValidCustomSetting(t)}static isCustomSettingsArray(t){return 0===t.length||t.every(t=>this.isCustomSetting(t))}}class CustomFont{constructor(t,e,n){this.fontName=t,this.localName=e,this.url=n}static injectCSS(t){const e=[];return e.push(`@font-face { font-family: '${t.fontName}';`),(t.url||t.localName)&&e.push("src: "),t.url&&t.localName?e.push(`local('${t.localName}'), url('${t.url}');}\n`):t.localName&&!t.url?e.push(`local('${t.localName}');}\n`):t.url&&!t.localName&&e.push(`url('${t.url}');}\n`),e.join("")}static isFontInstalled(t){var e=document.createElement("span");function n(t){e.style.fontFamily=t,document.body.appendChild(e);let n=e.clientWidth;return document.body.removeChild(e),n}e.innerHTML=Array(100).join("wi"),e.style.cssText=["position:absolute","width:auto","font-size:128px","left:-99999px"].join(" !important;");var s=n("monospace"),o=n("serif"),r=n("sans-serif");return s!==n(t+",monospace")||r!==n(t+",sans-serif")||o!==n(t+",serif")}static async isFontUrlValid(t){return fetch(t).then(t=>t.ok).catch(()=>!1)}static async isFontValid(t){let e=!0,n=!0;return t.localName&&(e=CustomFont.isFontInstalled(t.localName)),t.url&&(n=await CustomFont.isFontUrlValid(t.url)),e&&n}static isValidCustomFont(t){const e=t.fontName,n=t.localName,s=t.url;return!!e&&"string"==typeof e&&!!n&&"string"==typeof n&&!!s&&"string"==typeof s}static isCustomFont(t){return!!t&&t.hasOwnProperty("fontName")&&t.hasOwnProperty("localName")&&t.hasOwnProperty("url")&&this.isValidCustomFont(t)}static isCustomFontsArray(t){return 0===t.length||t.every(t=>this.isCustomFont(t))}}const runtime=(()=>isChromium?chrome.runtime:browser.runtime)(),sync={get:async(t=null)=>new Promise(e=>{isChromium?chrome.storage.sync.get(t,t=>e(t)):browser.storage.sync.get(t).then(t=>e(t))}),set:async t=>new Promise(e=>{isChromium?chrome.storage.sync.set(t,()=>e()):browser.storage.sync.set(t).then(()=>e())})},tabs={create:async t=>new Promise(e=>{isChromium?chrome.tabs.create({url:t},t=>e(t)):browser.tabs.create({url:t}).then(t=>e(t))}),queryAllTabs:async()=>new Promise(t=>{isChromium?chrome.tabs.query({},e=>t(e)):browser.tabs.query({}).then(e=>t(e))}),queryCurrentTab:async()=>new Promise(t=>{isChromium?chrome.tabs.query({active:!0,currentWindow:!0},e=>t(e)):browser.tabs.query({active:!0,currentWindow:!0}).then(e=>t(e))}),sendMessage(t,e){isChromium?chrome.tabs.sendMessage(t,e):browser.tabs.sendMessage(t,e)}};async function injectCustomFonts(t){let e=get("wudoohCustomFontsStyle");return e&&(e.textContent="",document.head.removeChild(e),e=null),(e=document.createElement("style")).id="wudoohCustomFontsStyle",t.forEach(t=>{e.textContent=e.textContent.concat(CustomFont.injectCSS(t))}),document.head.append(e),t}function analytics(t){if(!window.ga){window.ga=function(){(window.ga.q=window.ga.q||[]).push(arguments)},window.ga.l=(new Date).valueOf();const t=document.createElement("script"),e=document.getElementsByTagName("script")[0];t.async=!0,t.src="https://www.google-analytics.com/analytics.js",e.parentNode.insertBefore(t,e),window.ga("create","UA-164482478-2","auto"),window.ga("set","checkProtocolTask",null)}window.ga("send","pageview",t)}function get(t){return document.getElementById(t)}function wait(t,e){return setTimeout(e,t)}Array.prototype.contains=function(t){return-1!==this.indexOf(t)},String.prototype.contains=function(t){return-1!==this.indexOf(t)},Element.prototype.postDelayed=function(t,e){let n=wait(t,()=>{n===this.currentTask&&e.call(this)});this.currentTask=n};