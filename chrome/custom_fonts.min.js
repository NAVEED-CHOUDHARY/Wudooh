const template=get("template"),fontsDiv=get("fontsDiv"),fontNameInput=get("fontNameInput"),localNameInput=get("localNameInput"),urlInput=get("urlInput"),addButton=get("addButton"),infoLabel=get("infoLabel"),fontTest=get("fontTest"),templateDiv=template.content.querySelector("div");let displayedFonts=[];async function initializeCustomFonts(){const t=await sync.get([keyCustomFonts]);displayedFonts=[],t.customFonts.forEach(t=>{displayFont(t),displayedFonts.push(t.fontName)})}async function injectTemporaryCustomFont(t){let n=get("wudoohCustomFontsStyle");n||((n=document.createElement("style")).id="wudoohCustomFontsStyle",document.head.append(n)),n.innerHTML=CustomFont.injectCSS(t)}async function notifyAllTabsCustomFontsChanged(t){(await tabs.queryAllTabs()).forEach(n=>{let e={reason:reasonInjectCustomFonts,customFonts:t};tabs.sendMessage(n.id,e)})}function displayFont(t){const n=t.fontName,e=t.localName,o=t.url,a=document.importNode(templateDiv,!0),l=a.children.namedItem("templateFontTitle"),s=a.getElementsByTagName("input"),u=s.namedItem("templateFontNameInput"),i=s.namedItem("templateUrlInput"),m=s.namedItem("templateLocalNameInput"),d=a.children.namedItem("templateDeleteButton"),p=a.children.namedItem("templateCheckIcon"),c=a.children.namedItem("templateErrorIcon"),r=a.children.namedItem("templateInfoText"),y=[a,l,u,i,m,d,p,c,r];p.style.display="none",c.style.display="none",u.value=n,i.value=o,m.value=e;const f=`-${t.fontName}`;y.forEach(t=>t.id+=f),fontsDiv.appendChild(a),d.onclick=(()=>{if(confirm(`Are you sure you want to delete ${u.value}\nThis cannot be undone`)){let t,n=u.value;sync.get([keyCustomFonts]).then(e=>(t=e.customFonts.filter(t=>t.fontName!==n),sync.set({customFonts:t}))).then(()=>{notifyAllTabsCustomFontsChanged(t),displayedFonts=t.map(t=>t.fontName),a.parentNode.removeChild(a)})}})}function inputOnInput(){this.postDelayed(250,()=>{const t=fontNameInput.value,n=urlInput.value,e=localNameInput.value;injectTemporaryCustomFont(new CustomFont(t,e,n)),fontTest.style.fontFamily=t})}async function addButtonOnClick(){let t=fontNameInput.value,n=urlInput.value,e=localNameInput.value;if(""==t&&(t=null),""==n&&(n=null),""==e&&(e=null),!t)return infoLabel.style.display="block",void(infoLabel.innerText="Font Name cannot be empty!");if(!n&&!e)return infoLabel.style.display="block",void(infoLabel.innerText="URL and local cannot both be empty!");if(displayedFonts.contains(t)||allWudoohFonts.contains(t))return infoLabel.style.display="block",void(infoLabel.innerText="A font with this Font Name already exists!");infoLabel.innerText="";const o=(await sync.get([keyCustomFonts])).customFonts,a=new CustomFont(t,e,n);o.push(a),await sync.set({customFonts:o}),displayFont(a),displayedFonts.push(a.fontName),notifyAllTabsCustomFontsChanged(o),infoLabel.style.display="none",fontNameInput.value="",urlInput.value="",localNameInput.value=""}function customFontsAddListeners(){function t(t){"Enter"===t.code&&addButton.click()}document.addEventListener("DOMContentLoaded",initializeCustomFonts),fontNameInput.onkeypress=t,localNameInput.onkeypress=t,urlInput.onkeypress=t,fontNameInput.oninput=inputOnInput,localNameInput.oninput=inputOnInput,urlInput.oninput=inputOnInput,addButton.onclick=addButtonOnClick}customFontsAddListeners();