const template=get("template"),fontsDiv=get("fontsDiv"),fontNameInput=get("fontNameInput"),localNameInput=get("localNameInput"),urlInput=get("urlInput"),addButton=get("addButton"),infoLabel=get("infoLabel"),fontTest=get("fontTest"),templateDiv=template.content.querySelector("div");let displayedFonts=[];function injectTemporaryCustomFont(t,e,n){let o=get("wudoohCustomFontsStyle");o||((o=document.createElement("style")).id="wudoohCustomFontsStyle",document.head.append(o));let a=`@font-face { font-family: '${t}'; src: local('${n}')`;e&&(a=a.concat(`, url('${e}')`)),a=a.concat("; }\n"),o.innerHTML=a}function notifyCustomFontsChanged(t){tabs.queryAllTabs().then(e=>{e.forEach(e=>{let n={reason:reasonInjectCustomFonts,customFonts:t};tabs.sendMessage(e.id,n)})})}function displayFont(t){const e=t.fontName,n=t.localName,o=t.url,a=document.importNode(templateDiv,!0),l=a.getElementsByTagName("input"),s=l.namedItem("templateFontNameInput"),u=l.namedItem("templateUrlInput"),i=l.namedItem("templateLocalNameInput"),d=a.children.namedItem("templateDeleteButton");s.value=e,u.value=o,i.value=n;let p=`-${t.fontName}`;a.id+=p,s.id+=p,u.id+=p,i.id+=p,d.id+=p,fontsDiv.appendChild(a),d.onclick=(()=>{if(confirm(`Are you sure you want to delete ${s.value}\nThis cannot be undone`)){let t,e=s.value;sync.get([keyCustomFonts]).then(n=>(t=n.customFonts.filter(t=>t.fontName!==e),sync.set({customFonts:t}))).then(()=>{notifyCustomFontsChanged(t),displayedFonts=t.map(t=>t.fontName),a.parentNode.removeChild(a)})}})}function pressedEnter(t){"Enter"===t.code&&addButton.click()}function initializeCustomFonts(){sync.get([keyCustomFonts]).then(t=>{let e=t.customFonts;displayedFonts=[],e.forEach(t=>{displayFont(t),displayedFonts.push(t.fontName)})})}function inputOnInput(){this.postDelayed(250,()=>{let t=CSS.escape(fontNameInput.value);injectTemporaryCustomFont(t,CSS.escape(urlInput.value),CSS.escape(localNameInput.value)),fontTest.style.fontFamily=t})}function addButtonOnClick(){let t=fontNameInput.value,e=urlInput.value,n=localNameInput.value;""==t&&(t=null),""==e&&(e=null),""==n&&(n=null);let o=!0;if(!t)return o=!1,infoLabel.style.display="block",void(infoLabel.innerText="Font Name cannot be empty!");if(!e&&!n)return o=!1,infoLabel.style.display="block",void(infoLabel.innerText="URL and local cannot both be empty!");if(displayedFonts.contains(t)||allWudoohFonts.contains(t))return o=!1,infoLabel.style.display="block",void(infoLabel.innerText="A font with this Font Name already exists!");if(o){let o,a;infoLabel.innerText="",sync.get([keyCustomFonts]).then(l=>(o=l.customFonts,a=new CustomFont(t,n,e),o.push(a),sync.set({customFonts:o}))).then(()=>{displayFont(a),displayedFonts.push(a.fontName),notifyCustomFontsChanged(o),infoLabel.style.display="none",fontNameInput.value="",urlInput.value="",localNameInput.value=""})}}function customFontsAddListeners(){document.addEventListener("DOMContentLoaded",initializeCustomFonts),fontNameInput.onkeypress=pressedEnter,localNameInput.onkeypress=pressedEnter,urlInput.onkeypress=pressedEnter,fontNameInput.oninput=inputOnInput,localNameInput.oninput=inputOnInput,urlInput.oninput=inputOnInput,addButton.onclick=addButtonOnClick}customFontsAddListeners();